<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme Discovery Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .log {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        h1 { color: #333; }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
        }
        button:hover { background: #2980b9; }
        select {
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 14px;
            min-width: 200px;
        }
    </style>
</head>
<body>
    <h1>🎨 Theme Discovery Debug Tool</h1>

    <div>
        <button onclick="testThemeDiscovery()">Test Theme Discovery</button>
        <button onclick="testSingleTheme()">Test Single Theme Fetch</button>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>

    <h2>Theme Selector</h2>
    <select id="themeSelect">
        <option value="default">Default</option>
    </select>

    <h2>Logs</h2>
    <div id="logs"></div>

    <script>
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.className = `log ${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        async function testSingleTheme() {
            log('Testing single theme fetch: theme-mork-borg.css', 'info');

            try {
                const response = await fetch('theme-mork-borg.css');
                log(`Response status: ${response.status}`, response.ok ? 'success' : 'error');
                log(`Response ok: ${response.ok}`, response.ok ? 'success' : 'error');

                if (response.ok) {
                    const text = await response.text();
                    log(`Content length: ${text.length} characters`, 'success');
                    log(`First 200 chars: ${text.substring(0, 200)}`, 'info');

                    const match = text.match(/\/\*\s*THEME:\s*(.+?)\s*\*\//);
                    if (match) {
                        log(`✅ Theme name extracted: "${match[1]}"`, 'success');
                    } else {
                        log('❌ No theme name found in CSS', 'error');
                    }
                }
            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
            }
        }

        async function testThemeDiscovery() {
            log('Starting theme discovery test...', 'info');

            const possibleThemes = [
                'theme-mork-borg.css',
                'theme-dark.css',
                'theme-high-contrast.css',
                'theme-retro.css'
            ];

            const themes = new Map();
            const themeFiles = [];

            for (const themeFile of possibleThemes) {
                try {
                    log(`Checking: ${themeFile}`, 'info');
                    const response = await fetch(themeFile);
                    log(`  Status: ${response.status}, OK: ${response.ok}`, response.ok ? 'success' : 'error');

                    if (response.ok) {
                        const text = await response.text();
                        const match = text.match(/\/\*\s*THEME:\s*(.+?)\s*\*\//);

                        if (match) {
                            const themeName = match[1].trim();
                            themes.set(themeFile, themeName);
                            themeFiles.push({ file: themeFile, name: themeName });
                            log(`  ✅ Found: "${themeName}"`, 'success');
                        } else {
                            log(`  ⚠️ No theme name found`, 'error');
                        }
                    }
                } catch (error) {
                    log(`  ❌ Error: ${error.message}`, 'error');
                }
            }

            log(`\nDiscovered ${themes.size} themes`, themes.size > 0 ? 'success' : 'error');

            // Populate selector
            const select = document.getElementById('themeSelect');
            select.innerHTML = '<option value="default">Default</option>';
            themeFiles.forEach(theme => {
                const option = document.createElement('option');
                option.value = theme.file;
                option.textContent = theme.name;
                select.appendChild(option);
                log(`Added to selector: ${theme.name}`, 'success');
            });
        }

        // Auto-run on load
        window.addEventListener('DOMContentLoaded', () => {
            log('Debug tool loaded', 'info');
            log('Click "Test Theme Discovery" to start', 'info');
        });
    </script>
</body>
</html>
