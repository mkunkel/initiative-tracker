<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Initiative Tracker</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Session Selector, Game Selector and Clear Button -->
    <div class="top-controls">
        <button id="clearAll" class="clear-btn-top">Clear All</button>
        <div class="session-selector">
            <label for="sessionSelect">Session:</label>
            <select id="sessionSelect">
                <option value="">Select a session...</option>
            </select>
            <button id="manageSessionsBtn" class="manage-sessions-btn" title="Manage Sessions">‚öôÔ∏è</button>
        </div>
        <div class="game-selector">
            <label for="gameSelect">Game:</label>
            <select id="gameSelect">
                <option value="">Loading...</option>
            </select>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>RPG Initiative Tracker</h1>
            <!-- Total Attack Indicator (only shows for games with threats) -->
            <div id="totalAttackIndicator" class="total-attack-indicator" style="display: none;">
                <span class="total-attack-label">Total Attack:</span>
                <span class="total-attack-value">0</span>
            </div>

            <!-- Add Buttons -->
            <div class="add-buttons">
                <button id="openCharacterModal" class="add-btn add-character-btn">‚ûï Add Character</button>
                <button id="openEnemyModal" class="add-btn add-enemy-btn">‚ûï Add Enemy</button>
            </div>
        </header>

        <main>
            <div class="tracker-container">
                <!-- On Deck Column -->
                <div class="column" id="onDeck">
                    <h2>On Deck</h2>
                    <div class="character-list" id="onDeckList">
                        <!-- Characters will be added here -->
                    </div>
                </div>

                <!-- Completed Column -->
                <div class="column" id="completed">
                    <h2>Completed</h2>
                    <div class="character-list" id="completedList">
                        <!-- Completed characters will be added here -->
                    </div>
                </div>
            </div>

            <!-- Completed Objectives Section (only for games with objectives) -->
            <div class="initiative-sections" id="completedObjectivesSection" style="display: none;">
                <div class="column" id="completedObjectivesColumn">
                    <h2>‚úÖ Completed Objectives</h2>
                    <div class="character-list" id="completedObjectivesList">
                        <!-- Completed objectives appear here -->
                    </div>
                </div>
            </div>

            <!-- Stunned and Dead Sections -->
            <div class="status-container">
                <!-- Stunned Column -->
                <div class="column status-column" id="stunned">
                    <h2>Stunned</h2>
                    <div class="character-list" id="stunnedList">
                        <!-- Stunned characters will be added here -->
                    </div>
                </div>

                <!-- Dead Column -->
                <div class="column status-column" id="dead">
                    <h2>Dead</h2>
                    <div class="character-list" id="deadList">
                        <!-- Dead characters will be added here -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Round Complete Modal -->
        <div class="modal" id="roundCompleteModal">
            <div class="modal-content">
                <h2>Round Complete!</h2>
                <p>All characters have completed their turns.</p>
                <button id="startNextRound">Start Next Round</button>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal" id="deleteModal">
            <div class="modal-content">
                <h2>Confirm Delete</h2>
                <p>Are you sure you want to remove this character?</p>
                <div class="modal-buttons">
                    <button id="confirmDelete">Yes, Delete</button>
                    <button id="cancelDelete">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Rename Entity Modal -->
        <div class="modal" id="renameModal">
            <div class="modal-content">
                <h2>Rename Entity</h2>
                <div class="form-field">
                    <label for="renameInput">New Name</label>
                    <input type="text" id="renameInput" placeholder="Enter new name" required>
                </div>
                <div class="modal-buttons">
                    <button id="confirmRename" class="primary-btn">Rename</button>
                    <button id="cancelRename" class="secondary-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Stun Rounds Modal -->
        <div class="modal" id="stunModal">
            <div class="modal-content">
                <h2>Stun Duration</h2>
                <p>How many rounds should this character be stunned?</p>
                <div class="stun-counter">
                    <button id="stunDecrease" class="stun-btn">‚àí</button>
                    <div id="stunRoundsDisplay" class="stun-display">1</div>
                    <button id="stunIncrease" class="stun-btn">+</button>
                </div>
                <div class="modal-buttons">
                    <button id="confirmStun">Confirm</button>
                    <button id="cancelStun">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Add Character Modal -->
        <div class="modal" id="addCharacterModal">
            <div class="modal-content modal-form">
                <h2>Add Character</h2>
                <div class="form-field">
                    <label for="modalCharacterName">Character Name</label>
                    <div class="input-with-refresh">
                        <span id="modalRefreshName" class="refresh-icon" title="Generate new name">üîÑ</span>
                        <input type="text" id="modalCharacterName" placeholder="Enter character name" required>
                    </div>
                </div>
                <div class="form-field">
                    <label>Character Type</label>
                    <div class="entity-type-selector">
                        <label class="radio-label" title="Player Character">
                            <input type="radio" name="entityType" value="pc" id="entityTypePC" checked>
                            <div class="entity-type-option">
                                <span class="entity-type-icon">üë§</span> PC
                            </div>
                        </label>
                        <label class="radio-label" title="Non-Player Character">
                            <input type="radio" name="entityType" value="npc" id="entityTypeNPC">
                            <div class="entity-type-option">
                                <span class="entity-type-icon">ü§ù</span> NPC
                            </div>
                        </label>
                    </div>
                </div>
                <div class="form-field" id="characterHPField">
                    <label for="modalCharacterHP" id="characterResourceLabel">Hit Points</label>
                    <div class="hp-controls">
                        <button class="hp-btn modal-hp-btn" data-modal="character" data-action="decrease">‚àí</button>
                        <div class="hp-display" id="modalCharacterHP">5</div>
                        <button class="hp-btn modal-hp-btn" data-modal="character" data-action="increase">+</button>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="modalAddCharacter" class="primary-btn">Add Character</button>
                    <button id="cancelCharacterModal" class="secondary-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Add Enemy Modal -->
        <div class="modal" id="addEnemyModal">
            <div class="modal-content modal-form">
                <h2>Add Enemy</h2>
                <div class="form-field">
                    <label for="modalEnemyName">Enemy Name</label>
                    <input type="text" id="modalEnemyName" placeholder="Enter enemy name" value="Enemy 1">
                </div>
                <div class="form-field" id="enemySubtypeField" style="display: none;">
                    <label>Enemy Type</label>
                    <div class="enemy-subtype-selector">
                        <!-- Dynamically populated based on game config -->
                    </div>
                </div>
                <div class="form-field" id="enemyHPField">
                    <label for="modalEnemyHP" id="enemyResourceLabel">Hit Points</label>
                    <div class="hp-controls">
                        <button class="hp-btn modal-hp-btn" data-modal="enemy" data-action="decrease">‚àí</button>
                        <div class="hp-display" id="modalEnemyHP">5</div>
                        <button class="hp-btn modal-hp-btn" data-modal="enemy" data-action="increase">+</button>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="modalAddEnemy" class="primary-btn">Add Enemy</button>
                    <button id="cancelEnemyModal" class="secondary-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Session Warning Banner -->
        <div id="sessionWarningBanner" class="session-warning-banner" style="display: none;">
            <div class="warning-content">
                <span class="warning-icon">‚ÑπÔ∏è</span>
                <span class="warning-text" id="warningText"></span>
                <button id="saveWarningSession" class="warning-btn">üíæ Save as Campaign</button>
                <button id="dismissWarning" class="warning-btn warning-dismiss">Dismiss</button>
            </div>
        </div>

        <!-- Session Cleanup Modal -->
        <div class="modal" id="sessionCleanupModal">
            <div class="modal-content">
                <h2>‚ö†Ô∏è Old Quick Game Found</h2>
                <div id="cleanupContent">
                    <!-- Content will be inserted by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Manage Sessions Modal -->
        <div class="modal" id="manageSessionsModal">
            <div class="modal-content modal-large">
                <h2>Manage Game Sessions</h2>

                <div class="session-actions">
                    <button id="newCampaignBtn" class="session-action-btn primary-btn">
                        <span class="btn-icon">üìÅ</span> New Campaign
                    </button>
                    <button id="newQuickGameBtn" class="session-action-btn quick-btn">
                        <span class="btn-icon">‚ö°</span> Quick Game
                    </button>
                    <button id="importSessionsBtn" class="session-action-btn import-btn">
                        <span class="btn-icon">üì•</span> Import
                    </button>
                    <button id="exportAllSessionsBtn" class="session-action-btn export-btn">
                        <span class="btn-icon">üì§</span> Export All
                    </button>
                    <input type="file" id="importFileInput" accept=".json" style="display: none;">
                </div>

                <div class="sessions-container">
                    <div class="sessions-section">
                        <h3>Campaigns</h3>
                        <div id="campaignsList" class="sessions-list">
                            <!-- Campaign sessions will be listed here -->
                        </div>
                    </div>

                    <div class="sessions-section">
                        <h3>Quick Games</h3>
                        <div id="quickGamesList" class="sessions-list">
                            <!-- Quick game sessions will be listed here -->
                        </div>
                    </div>
                </div>

                <div class="modal-buttons">
                    <button id="closeManageSessionsBtn" class="secondary-btn">Close</button>
                </div>
            </div>
        </div>

        <!-- New Campaign Name Modal -->
        <div class="modal" id="newCampaignModal">
            <div class="modal-content">
                <h2>New Campaign</h2>
                <div class="form-field">
                    <label for="campaignNameInput">Campaign Name</label>
                    <input type="text" id="campaignNameInput" placeholder="Enter campaign name" required>
                </div>
                <div class="modal-buttons">
                    <button id="createCampaignBtn" class="primary-btn">Create</button>
                    <button id="cancelNewCampaignBtn" class="secondary-btn">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Rename Session Modal -->
        <div class="modal" id="renameSessionModal">
            <div class="modal-content">
                <h2>Rename Session</h2>
                <div class="form-field">
                    <label for="renameSessionInput">New Name</label>
                    <input type="text" id="renameSessionInput" placeholder="Enter new name" required>
                </div>
                <div class="modal-buttons">
                    <button id="confirmRenameBtn" class="primary-btn">Rename</button>
                    <button id="cancelRenameBtn" class="secondary-btn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/game-config.js"></script>
    <script src="js/session-manager.js"></script>
    <script src="js/script.js"></script>
</body>
</html>
